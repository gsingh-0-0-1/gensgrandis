<!-- Copyright (C) Gurmehar Singh 2020 - All Rights Reserved
/* Unauthorized copying or distribution of this file, via any medium is strictly prohibited
/* Proprietary and confidential
/* Written by Gurmehar Singh <gurmehar@gmail.com>
/-->

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">

	<title>Gēns Grandis</title>

	<style>
		body{
			background-color: #222;
			color: #ccc;
			font-family: Courier;
			font-size: 20px;
		}
		.chatbuttondiv{
			position: fixed;
			left: 60%;
			top: 10%;
			width: 40%;
			height: 90%;
		}

		.input{
			border: none; 
			padding: 0.1rem 1rem; 
			flex-grow: 1; 
			margin: 0.05rem; 
		}

		.input:focus{
			outline: none; 
		}

		.multibuttons > span:nth-of-type(1n) {background-color: #bb8181;}
		.multibuttons > span:nth-of-type(2n) {background-color: #81bb81;}
		.multibuttons{
			text-align: center;
		}

		.roombutton:focus{
			filter: brightness(110%);
			outline: none;
		}


		ul {
			font-family: Times;
			position: relative;
			list-style-type: none;
			margin: 0;
			padding: 0;
			overflow: hidden;
			background-color: #333;
			z-index: 3;
		}

		li {
			float: left;
		}

		li a {
			display: block;
			color: white;
			text-align: center;
			padding: 14px 16px;
			text-decoration: none;
		}

		li a:hover {
			background-color: #111;
		}

	</style>
</head>
<body>

	<ul>
		<li><a class="active" href="/">Home</a></li>
		<!--<li><a href="/funds">Funds</a></li>-->
	</ul>

	<br>

	<span class="roombutton" type="button" id="buttontemplate" style="display: none; color: #222; font-family: Courier; font-size: 20px; border: none; padding: 5px 5px; position: relative;" onclick="javascript:handleButton(this)">
	</span>
	<div style="width: 60%">
		<span style="font-size: 30px; color: #bb9191">Welcome to Gēns Grandis!</span>
		<br>
		<br>
		Thanks for playing! This game was inspired both by Minecraft and Civilization IV, and aims to combine elements of both to create a strategy-oriented but also sandbox-style game.
		<br><br>
		We aren't running ads just yet - our goal is to get a critical mass of users using the website, at which point we can enable ads. <!--Half of all the ad revenue this game makes will be donated to various charities and initiatives - you can see a list of charities that we plan to donate to on our "Funds" page.-->
		<br><br>
		If you've never played the game before, go ahead and start with Singleplayer - it'll give you a tutorial of how the game works. From there, you can keep playing singleplayer, or move to multiplayer if you've got some friends to play with.
		<br><br>
		And, last but not least, I'd like to mention - this game is very much under development. There might be some bugs here and there - after all, this is effectively a public beta - but I've run as many tests as I can, and I'm confident that it should be relatively stable. Additionally, as this expands, I won't be able to do everything by myself - if you've got experience with Blender or frontend/UI design, or if you think you can contribute in any way to this effort, please feel free to join our discord (<a href="https://discord.gg/47QQtwFeYu" style="color: #9999a1" target="_blank">https://discord.gg/47QQtwFeYu</a>) or shoot me an email. Who knows, maybe you'll get a cut of that sweet ad revenue &#128521;.
		<br><br>
		Thanks again, and I hope you enjoy the game!
	</div>

	<div style="position: fixed; font-size: 20px; color: #999; bottom: 1%; right: 1%; font-family: Courier;">
		Developed by: Gurmehar Singh<br>
		(gensgrandis@gmail.com)
	</div>

	<br>
	<br>

	<form action="/game">
		<input type="Submit" style="display: inline-block; background-color: #88b; color: #fff; padding: 15px 15px; font-size: 20px; font-family: Courier" value="Play Singleplayer >>">
	</form>


	<div style="position: fixed; left: 70%; top: 10%; text-align: center">
		<span style="font-size: 25px; color: #9191aa">-- Join a multiplayer lobby --</span>
		<br>
		Available Rooms: 1 to <span id="maxrooms"></span><br><br>(I-G : "In-Game")<br><br>
		<div id="multibuttons" class="multibuttons">
		</div>
	</div>

</body>

<script src="/templates/socket.io.js"></script>

<script>

	var socket = io("/")

	socket.on('roomupdate', function(room, numusers){
		console.log(room, numusers)
		document.getElementById(room + "_plct").textContent = numusers
	})

	function handleInput(event){
		if (event.keyCode == 13){
			var room = document.getElementById("roomnum").value
			if (isNaN(room)){
				return
			}
			var maxrooms = document.getElementById("maxrooms").textContent
			if (isNaN(maxrooms)){
				return
			}
			if (room*1 > maxrooms*1 || room*1 <= 0){
				return
			}
			window.location.href += "room/" + room
			return false;
		}
	}

	function handleButton(obj){
		window.location.href += "room/" + (obj.textContent.split(" ")[1] * 1)
	}

	function initRoomPlayerVals(room){
		var req = new XMLHttpRequest;
		req.open("GET", "/maxplayers/" + room)
		req.send()

		req.onreadystatechange = function(){
			if (this.readyState == 4 && this.status == 200){
				document.getElementById(room + "_maxpl").textContent = this.responseText
			}
		}

		var cur_pl_req = new XMLHttpRequest;
		cur_pl_req.open("GET", "/numcurrentplayers/" + room)
		cur_pl_req.send()

		cur_pl_req.onreadystatechange = function(){
			if (this.readyState == 4 && this.status == 200){
				document.getElementById(room + "_plct").textContent = this.responseText
			}
		}
	}

	var roomreq = new XMLHttpRequest;
	roomreq.open("GET", "/approvedrooms")
	roomreq.send()
	roomreq.onreadystatechange = function(){
		if (this.readyState == 4 && this.status == 200){
			var rooms = this.responseText * 1
			document.getElementById("maxrooms").textContent = rooms

			var roomstrlength = String(rooms).length

			var origbutton = document.getElementById("buttontemplate")

			for (var i = 1; i <= rooms; i++){
				var b = origbutton.cloneNode(true)
				b.style.display = "inline"

				var roomnum = String(i)

				while (roomnum.length < roomstrlength){
					roomnum = "0" + roomnum
				}

				b.innerHTML = "Room " + roomnum 
				b.innerHTML += " [<span id='" + i + "_plct'></span>/<span id='" + i + "_maxpl'></span>]"

				initRoomPlayerVals(i)

				if (i % 2 == 0){
					b.style.left = "5%"
				}

				if (i % 2 == 1){
					b.style.left = "-5%"
				}
				document.getElementById("multibuttons").appendChild(b)
				if (i % 2 == 0){
					for (var j = 0; j < 2; j++){
						document.getElementById("multibuttons").appendChild(document.createElement('br'))
					}
				}
			}
		}
	}
</script>
</html>