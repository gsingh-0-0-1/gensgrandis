<!-- Copyright (C) Gurmehar Singh 2020 - All Rights Reserved
/* Unauthorized copying or distribution of this file, via any medium is strictly prohibited
/* Proprietary and confidential
/* Written by Gurmehar Singh <gurmehar@gmail.com>
/-->

<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="google-site-verification" content="Wm67db8wTj_MDhFfzwgS_BhR0QvqpNc2fhla6nQm51w" />
	<meta charset="UTF-8">

	<title>GÄ“ns Grandis</title>

	<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300&display=swap" rel="stylesheet">
	<link href="css/navbar.css" rel="stylesheet">

	<style>
		body{
			background-color: #222;
			color: #ccc;
			font-family: Lato;
			font-size: 20px;
		}
		.chatbuttondiv{
			position: fixed;
			left: 60%;
			top: 10%;
			width: 40%;
			height: 90%;
		}

		.input{
			border: none; 
			padding: 0.1rem 1rem; 
			flex-grow: 1; 
			margin: 0.05rem; 
		}

		.input:focus{
			outline: none; 
		}

		.multibuttons > button:nth-of-type(1n) {background-color: #bb8181;}
		.multibuttons > button:nth-of-type(2n) {background-color: #81bb81;}
		.multibuttons{
			text-align: center;
		}

		.roombutton:focus{
			filter: brightness(110%);
			outline: none;
		}

	</style>
</head>
<body>

	<br>

	<button class="roombutton" type="Submit" id="buttontemplate" style="display: none; color: #222; font-family: Courier; font-size: 0.9vw; border: none; padding: 5px 5px; position: relative;" onclick="javascript:handleButton(this)">
	</button>
	<div style="width: 60%">
		<span style="font-size: 30px; color: #bb9191">Welcome to Gens Grandis!</span>
		<br>
		<br>
		Hi there, great to see you here! Gens Grandis is a strategy-oriented and sandbox-style game that runs entirely in your browser.
		<br><br>
		If you've never played the game before, go ahead and start with Singleplayer - it'll give you a short tutorial of how the game basics. From there, you can keep exploring the game interface in singleplayer, or move to multiplayer with some friends.
		<br><br>
		I hope you'll consider giving the <a href="/about" style="color: #88b">About</a> page a look - there's some information there you'll be interested in.
		<br><br>
		And, last but not least, I'd like to mention - this game is very much under development. There might be some bugs here and there - after all, this is effectively a public beta - but I've run as many tests as I can, and I'm confident that it should be relatively stable. Additionally, as this expands, I won't be able to do everything by myself - if you've got experience with Blender or frontend/UI design, or if you think you can contribute in any way to this effort, please feel free to join our Discord (<a href="https://discord.gg/47QQtwFeYu" style="color: #9999a1" target="_blank">https://discord.gg/47QQtwFeYu</a>) or our Reddit (<a href="https://www.reddit.com/r/GensGrandis/" style="color: #9999a1" target="_blank">https://www.reddit.com/r/GensGrandis/</a>) - or even shoot me an email.
		<br><br>
		Thanks again - I hope you enjoy the game!
	</div>

	<div style="position: fixed; font-size: 20px; color: #999; bottom: 1%; right: 1%; font-family: Lato;">
		Developed by: Gurmehar Singh<br>
		(gensgrandis@gmail.com)
	</div>

	<br>
	<br>

	<form action="/game">
		<input type="Submit" style="display: inline-block; background-color: #88b; color: #fff; padding: 15px 15px; font-size: 20px; font-family: Lato" value="Play Singleplayer >>">
	</form>


	<div style="position: fixed; left: 70%; top: 10%; text-align: center">
		<span style="font-size: 25px; color: #9191aa">-- Join a multiplayer lobby --</span>
		<br><br>
		<span style="font-size: 20px; color: #717199">(In Dev / Experimental)</span>
		<br><br>
		Available Rooms: 1 to <span id="maxrooms"></span><br><br>(I-G : "In-Game")<br><br>
		<form id="multibuttons" class="multibuttons" method="get">
			<input type="text" class="roombutton" name="username" placeholder="Username" required style="font-family: Lato; background-color: #aaa; color: #000; border: none; padding: 0.5vh 0.5vh"><br><br>
		</form>
	</div>

</body>

<script src="/js/socket.io.js"></script>
<script src="/js/navutils.js"></script>


<script>

	var socket = io("/")

	socket.on('roomupdate', function(room, numusers){
		console.log(room, numusers)
		document.getElementById(room + "_plct").textContent = numusers
	})

	function handleInput(event){
		if (event.keyCode == 13){
			var room = document.getElementById("roomnum").value
			if (isNaN(room)){
				return
			}
			var maxrooms = document.getElementById("maxrooms").textContent
			if (isNaN(maxrooms)){
				return
			}
			if (room*1 > maxrooms*1 || room*1 <= 0){
				return
			}
			window.location.href += "room/" + room
			return false;
		}
	}

	function handleButton(obj){
		//window.location.href += "room/" + (obj.textContent.split(" ")[1] * 1)
	}

	function initRoomPlayerVals(room){
		var req = new XMLHttpRequest;
		req.open("GET", "/maxplayers/" + room)
		req.send()

		req.onreadystatechange = function(){
			if (this.readyState == 4 && this.status == 200){
				document.getElementById(room + "_maxpl").textContent = this.responseText
			}
		}

		var cur_pl_req = new XMLHttpRequest;
		cur_pl_req.open("GET", "/numcurrentplayers/" + room)
		cur_pl_req.send()

		cur_pl_req.onreadystatechange = function(){
			if (this.readyState == 4 && this.status == 200){
				document.getElementById(room + "_plct").textContent = this.responseText
			}
		}
	}

	var roomreq = new XMLHttpRequest;
	roomreq.open("GET", "/approvedrooms")
	roomreq.send()
	roomreq.onreadystatechange = function(){
		if (this.readyState == 4 && this.status == 200){
			var rooms = this.responseText * 1
			document.getElementById("maxrooms").textContent = rooms

			var roomstrlength = String(rooms).length

			var origbutton = document.getElementById("buttontemplate")

			for (var i = 1; i <= rooms; i++){
				var b = origbutton.cloneNode(true)
				b.style.display = "inline"

				b.formAction = "/room/" + i

				var roomnum = String(i)

				while (roomnum.length < roomstrlength){
					roomnum = "0" + roomnum
				}

				b.innerHTML = "Room " + roomnum 
				b.innerHTML += " [<span id='" + i + "_plct'></span>/<span id='" + i + "_maxpl'></span>]"

				initRoomPlayerVals(i)

				if (i % 2 == 0){
					b.style.left = "5%"
				}

				if (i % 2 == 1){
					b.style.left = "-5%"
				}
				document.getElementById("multibuttons").appendChild(b)
				if (i % 2 == 0){
					for (var j = 0; j < 2; j++){
						document.getElementById("multibuttons").appendChild(document.createElement('br'))
					}
				}
			}
		}
	}
</script>
</html>